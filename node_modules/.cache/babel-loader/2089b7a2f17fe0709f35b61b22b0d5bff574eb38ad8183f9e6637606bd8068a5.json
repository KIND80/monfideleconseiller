{"ast":null,"code":"import _objectSpread from\"C:/Users/user/Downloads/monfideleconseiller/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React from\"react\";import{useEffect,useState}from\"react\";import{supabase}from\"./supabaseClient\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";export default function PortefeuilleAgent(_ref){let{agentId}=_ref;const[contacts,setContacts]=useState([]);const[callHistory,setCallHistory]=useState([]);const[commentaire,setCommentaire]=useState({});useEffect(()=>{const fetchData=async()=>{const{data:contactData}=await supabase.from(\"contacts\").select(\"*\").eq(\"agent_id\",agentId);const{data:appelsData}=await supabase.from(\"call_history\").select(\"*\").order(\"date\",{ascending:false});setContacts(contactData||[]);setCallHistory(appelsData||[]);};fetchData();},[agentId]);const validerSignature=async(contactId,type)=>{var _commentaire$contactI;const commentaireTexte=(_commentaire$contactI=commentaire[contactId])===null||_commentaire$contactI===void 0?void 0:_commentaire$contactI.trim();if(!commentaireTexte){alert(\"Merci de saisir un commentaire avant de valider.\");return;}await supabase.from(\"contacts\").update({statut:\"à_valider\"}).eq(\"id\",contactId);await supabase.from(\"call_history\").insert({contact_id:contactId,agent_id:agentId,statut_appel:\"Répondu\",commentaire:commentaireTexte||type});alert(\"\".concat(type,\" soumise \\xE0 validation.\"));setCommentaire(prev=>_objectSpread(_objectSpread({},prev),{},{[contactId]:\"\"}));};return/*#__PURE__*/_jsxs(\"div\",{style:{padding:20,maxWidth:800,margin:\"0 auto\",fontFamily:\"Arial\"},children:[/*#__PURE__*/_jsx(\"h1\",{children:\"\\uD83D\\uDCC1 Mon portefeuille\"}),contacts.map(c=>{const historique=callHistory.filter(h=>h.contact_id===c.id).slice(0,3);return/*#__PURE__*/_jsxs(\"div\",{style:{border:\"1px solid #ccc\",borderRadius:8,padding:15,marginBottom:20,backgroundColor:\"#fff\",boxShadow:\"0 2px 6px rgba(0,0,0,0.05)\"},children:[/*#__PURE__*/_jsx(\"h2\",{children:c.nom}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"\\uD83D\\uDCDE T\\xE9l\\xE9phone :\"}),\" \",c.telephone]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"\\uD83D\\uDCCB Cat\\xE9gorie :\"}),\" \",c.categorie_contact||\"—\"]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"\\uD83D\\uDEE1\\uFE0F Assurance :\"}),\" \",c.type_assurance||\"—\"]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"\\uD83C\\uDFE0 Adresse :\"}),\" \",c.adresse,\" \",c.npa]}),c.rdv_date&&/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"\\uD83D\\uDCC5 RDV pr\\xE9vu :\"}),\" \",new Date(c.rdv_date).toLocaleString()]}),/*#__PURE__*/_jsx(\"textarea\",{placeholder:\"Ajouter un commentaire ici...\",value:commentaire[c.id]||\"\",onChange:e=>setCommentaire(prev=>_objectSpread(_objectSpread({},prev),{},{[c.id]:e.target.value})),style:{width:\"100%\",marginTop:10,padding:8,borderRadius:4,border:\"1px solid #ccc\"}}),c.statut===\"rdv\"&&/*#__PURE__*/_jsxs(\"div\",{style:{marginTop:15},children:[/*#__PURE__*/_jsx(\"p\",{children:/*#__PURE__*/_jsx(\"strong\",{children:\"\\uD83D\\uDD53 RDV \\xE0 valider :\"})}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>validerSignature(c.id,\"Signature\"),style:{marginRight:10,backgroundColor:\"#4CAF50\",color:\"#fff\",padding:\"6px 10px\",border:\"none\",borderRadius:4},children:\"\\u2705 Signature\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>validerSignature(c.id,\"Non Signature\"),style:{backgroundColor:\"#f44336\",color:\"#fff\",padding:\"6px 10px\",border:\"none\",borderRadius:4},children:\"\\u274C Non Signature\"})]}),historique.length>0&&/*#__PURE__*/_jsxs(\"div\",{style:{marginTop:15,backgroundColor:\"#f7f7f7\",padding:10,borderRadius:6},children:[/*#__PURE__*/_jsx(\"strong\",{children:\"\\uD83D\\uDD53 3 derniers appels :\"}),/*#__PURE__*/_jsx(\"ul\",{style:{marginTop:6},children:historique.map(h=>/*#__PURE__*/_jsxs(\"li\",{children:[new Date(h.date).toLocaleString(),\" \\u2014 \",h.statut_appel,h.commentaire&&\" \\u2014 \".concat(h.commentaire)]},h.id))})]})]},c.id);})]});}","map":{"version":3,"names":["React","useEffect","useState","supabase","jsx","_jsx","jsxs","_jsxs","PortefeuilleAgent","_ref","agentId","contacts","setContacts","callHistory","setCallHistory","commentaire","setCommentaire","fetchData","data","contactData","from","select","eq","appelsData","order","ascending","validerSignature","contactId","type","_commentaire$contactI","commentaireTexte","trim","alert","update","statut","insert","contact_id","agent_id","statut_appel","concat","prev","_objectSpread","style","padding","maxWidth","margin","fontFamily","children","map","c","historique","filter","h","id","slice","border","borderRadius","marginBottom","backgroundColor","boxShadow","nom","telephone","categorie_contact","type_assurance","adresse","npa","rdv_date","Date","toLocaleString","placeholder","value","onChange","e","target","width","marginTop","onClick","marginRight","color","length","date"],"sources":["C:/Users/user/Downloads/monfideleconseiller/src/PortefeuilleAgent.tsx"],"sourcesContent":["import React from \"react\";\r\nimport { useEffect, useState } from \"react\";\r\nimport { supabase } from \"./supabaseClient\";\r\n\r\ntype Contact = {\r\n  id: string;\r\n  nom: string;\r\n  telephone: string;\r\n  adresse: string;\r\n  npa: string;\r\n  type_assurance: string;\r\n  categorie_contact: string;\r\n  agent_id: string;\r\n  rdv_date: string;\r\n  statut: string;\r\n};\r\n\r\ntype Appel = {\r\n  id: string;\r\n  contact_id: string;\r\n  date: string;\r\n  statut_appel: string;\r\n  commentaire: string;\r\n};\r\n\r\nexport default function PortefeuilleAgent({ agentId }: { agentId: string }) {\r\n  const [contacts, setContacts] = useState<Contact[]>([]);\r\n  const [callHistory, setCallHistory] = useState<Appel[]>([]);\r\n  const [commentaire, setCommentaire] = useState<Record<string, string>>({});\r\n\r\n  useEffect(() => {\r\n    const fetchData = async () => {\r\n      const { data: contactData } = await supabase\r\n        .from(\"contacts\")\r\n        .select(\"*\")\r\n        .eq(\"agent_id\", agentId);\r\n\r\n      const { data: appelsData } = await supabase\r\n        .from(\"call_history\")\r\n        .select(\"*\")\r\n        .order(\"date\", { ascending: false });\r\n\r\n      setContacts(contactData || []);\r\n      setCallHistory(appelsData || []);\r\n    };\r\n\r\n    fetchData();\r\n  }, [agentId]);\r\n\r\n  const validerSignature = async (\r\n    contactId: string,\r\n    type: \"Signature\" | \"Non Signature\"\r\n  ) => {\r\n    const commentaireTexte = commentaire[contactId]?.trim();\r\n\r\n    if (!commentaireTexte) {\r\n      alert(\"Merci de saisir un commentaire avant de valider.\");\r\n      return;\r\n    }\r\n\r\n    await supabase\r\n      .from(\"contacts\")\r\n      .update({\r\n        statut: \"à_valider\",\r\n      })\r\n      .eq(\"id\", contactId);\r\n\r\n    await supabase.from(\"call_history\").insert({\r\n      contact_id: contactId,\r\n      agent_id: agentId,\r\n      statut_appel: \"Répondu\",\r\n      commentaire: commentaireTexte || type,\r\n    });\r\n\r\n    alert(`${type} soumise à validation.`);\r\n    setCommentaire((prev) => ({ ...prev, [contactId]: \"\" }));\r\n  };\r\n\r\n  return (\r\n    <div\r\n      style={{\r\n        padding: 20,\r\n        maxWidth: 800,\r\n        margin: \"0 auto\",\r\n        fontFamily: \"Arial\",\r\n      }}\r\n    >\r\n      <h1>📁 Mon portefeuille</h1>\r\n      {contacts.map((c) => {\r\n        const historique = callHistory\r\n          .filter((h) => h.contact_id === c.id)\r\n          .slice(0, 3);\r\n\r\n        return (\r\n          <div\r\n            key={c.id}\r\n            style={{\r\n              border: \"1px solid #ccc\",\r\n              borderRadius: 8,\r\n              padding: 15,\r\n              marginBottom: 20,\r\n              backgroundColor: \"#fff\",\r\n              boxShadow: \"0 2px 6px rgba(0,0,0,0.05)\",\r\n            }}\r\n          >\r\n            <h2>{c.nom}</h2>\r\n            <p>\r\n              <strong>📞 Téléphone :</strong> {c.telephone}\r\n            </p>\r\n            <p>\r\n              <strong>📋 Catégorie :</strong> {c.categorie_contact || \"—\"}\r\n            </p>\r\n            <p>\r\n              <strong>🛡️ Assurance :</strong> {c.type_assurance || \"—\"}\r\n            </p>\r\n            <p>\r\n              <strong>🏠 Adresse :</strong> {c.adresse} {c.npa}\r\n            </p>\r\n            {c.rdv_date && (\r\n              <p>\r\n                <strong>📅 RDV prévu :</strong>{\" \"}\r\n                {new Date(c.rdv_date).toLocaleString()}\r\n              </p>\r\n            )}\r\n\r\n            <textarea\r\n              placeholder=\"Ajouter un commentaire ici...\"\r\n              value={commentaire[c.id] || \"\"}\r\n              onChange={(e) =>\r\n                setCommentaire((prev) => ({\r\n                  ...prev,\r\n                  [c.id]: e.target.value,\r\n                }))\r\n              }\r\n              style={{\r\n                width: \"100%\",\r\n                marginTop: 10,\r\n                padding: 8,\r\n                borderRadius: 4,\r\n                border: \"1px solid #ccc\",\r\n              }}\r\n            />\r\n\r\n            {c.statut === \"rdv\" && (\r\n              <div style={{ marginTop: 15 }}>\r\n                <p>\r\n                  <strong>🕓 RDV à valider :</strong>\r\n                </p>\r\n                <button\r\n                  onClick={() => validerSignature(c.id, \"Signature\")}\r\n                  style={{\r\n                    marginRight: 10,\r\n                    backgroundColor: \"#4CAF50\",\r\n                    color: \"#fff\",\r\n                    padding: \"6px 10px\",\r\n                    border: \"none\",\r\n                    borderRadius: 4,\r\n                  }}\r\n                >\r\n                  ✅ Signature\r\n                </button>\r\n\r\n                <button\r\n                  onClick={() => validerSignature(c.id, \"Non Signature\")}\r\n                  style={{\r\n                    backgroundColor: \"#f44336\",\r\n                    color: \"#fff\",\r\n                    padding: \"6px 10px\",\r\n                    border: \"none\",\r\n                    borderRadius: 4,\r\n                  }}\r\n                >\r\n                  ❌ Non Signature\r\n                </button>\r\n              </div>\r\n            )}\r\n\r\n            {historique.length > 0 && (\r\n              <div\r\n                style={{\r\n                  marginTop: 15,\r\n                  backgroundColor: \"#f7f7f7\",\r\n                  padding: 10,\r\n                  borderRadius: 6,\r\n                }}\r\n              >\r\n                <strong>🕓 3 derniers appels :</strong>\r\n                <ul style={{ marginTop: 6 }}>\r\n                  {historique.map((h) => (\r\n                    <li key={h.id}>\r\n                      {new Date(h.date).toLocaleString()} — {h.statut_appel}\r\n                      {h.commentaire && ` — ${h.commentaire}`}\r\n                    </li>\r\n                  ))}\r\n                </ul>\r\n              </div>\r\n            )}\r\n          </div>\r\n        );\r\n      })}\r\n    </div>\r\n  );\r\n}\r\n"],"mappings":"gIAAA,MAAO,CAAAA,KAAK,KAAM,OAAO,CACzB,OAASC,SAAS,CAAEC,QAAQ,KAAQ,OAAO,CAC3C,OAASC,QAAQ,KAAQ,kBAAkB,CAAC,OAAAC,GAAA,IAAAC,IAAA,CAAAC,IAAA,IAAAC,KAAA,yBAuB5C,cAAe,SAAS,CAAAC,iBAAiBA,CAAAC,IAAA,CAAmC,IAAlC,CAAEC,OAA6B,CAAC,CAAAD,IAAA,CACxE,KAAM,CAACE,QAAQ,CAAEC,WAAW,CAAC,CAAGV,QAAQ,CAAY,EAAE,CAAC,CACvD,KAAM,CAACW,WAAW,CAAEC,cAAc,CAAC,CAAGZ,QAAQ,CAAU,EAAE,CAAC,CAC3D,KAAM,CAACa,WAAW,CAAEC,cAAc,CAAC,CAAGd,QAAQ,CAAyB,CAAC,CAAC,CAAC,CAE1ED,SAAS,CAAC,IAAM,CACd,KAAM,CAAAgB,SAAS,CAAG,KAAAA,CAAA,GAAY,CAC5B,KAAM,CAAEC,IAAI,CAAEC,WAAY,CAAC,CAAG,KAAM,CAAAhB,QAAQ,CACzCiB,IAAI,CAAC,UAAU,CAAC,CAChBC,MAAM,CAAC,GAAG,CAAC,CACXC,EAAE,CAAC,UAAU,CAAEZ,OAAO,CAAC,CAE1B,KAAM,CAAEQ,IAAI,CAAEK,UAAW,CAAC,CAAG,KAAM,CAAApB,QAAQ,CACxCiB,IAAI,CAAC,cAAc,CAAC,CACpBC,MAAM,CAAC,GAAG,CAAC,CACXG,KAAK,CAAC,MAAM,CAAE,CAAEC,SAAS,CAAE,KAAM,CAAC,CAAC,CAEtCb,WAAW,CAACO,WAAW,EAAI,EAAE,CAAC,CAC9BL,cAAc,CAACS,UAAU,EAAI,EAAE,CAAC,CAClC,CAAC,CAEDN,SAAS,CAAC,CAAC,CACb,CAAC,CAAE,CAACP,OAAO,CAAC,CAAC,CAEb,KAAM,CAAAgB,gBAAgB,CAAG,KAAAA,CACvBC,SAAiB,CACjBC,IAAmC,GAChC,KAAAC,qBAAA,CACH,KAAM,CAAAC,gBAAgB,EAAAD,qBAAA,CAAGd,WAAW,CAACY,SAAS,CAAC,UAAAE,qBAAA,iBAAtBA,qBAAA,CAAwBE,IAAI,CAAC,CAAC,CAEvD,GAAI,CAACD,gBAAgB,CAAE,CACrBE,KAAK,CAAC,kDAAkD,CAAC,CACzD,OACF,CAEA,KAAM,CAAA7B,QAAQ,CACXiB,IAAI,CAAC,UAAU,CAAC,CAChBa,MAAM,CAAC,CACNC,MAAM,CAAE,WACV,CAAC,CAAC,CACDZ,EAAE,CAAC,IAAI,CAAEK,SAAS,CAAC,CAEtB,KAAM,CAAAxB,QAAQ,CAACiB,IAAI,CAAC,cAAc,CAAC,CAACe,MAAM,CAAC,CACzCC,UAAU,CAAET,SAAS,CACrBU,QAAQ,CAAE3B,OAAO,CACjB4B,YAAY,CAAE,SAAS,CACvBvB,WAAW,CAAEe,gBAAgB,EAAIF,IACnC,CAAC,CAAC,CAEFI,KAAK,IAAAO,MAAA,CAAIX,IAAI,6BAAwB,CAAC,CACtCZ,cAAc,CAAEwB,IAAI,EAAAC,aAAA,CAAAA,aAAA,IAAWD,IAAI,MAAE,CAACb,SAAS,EAAG,EAAE,EAAG,CAAC,CAC1D,CAAC,CAED,mBACEpB,KAAA,QACEmC,KAAK,CAAE,CACLC,OAAO,CAAE,EAAE,CACXC,QAAQ,CAAE,GAAG,CACbC,MAAM,CAAE,QAAQ,CAChBC,UAAU,CAAE,OACd,CAAE,CAAAC,QAAA,eAEF1C,IAAA,OAAA0C,QAAA,CAAI,+BAAmB,CAAI,CAAC,CAC3BpC,QAAQ,CAACqC,GAAG,CAAEC,CAAC,EAAK,CACnB,KAAM,CAAAC,UAAU,CAAGrC,WAAW,CAC3BsC,MAAM,CAAEC,CAAC,EAAKA,CAAC,CAAChB,UAAU,GAAKa,CAAC,CAACI,EAAE,CAAC,CACpCC,KAAK,CAAC,CAAC,CAAE,CAAC,CAAC,CAEd,mBACE/C,KAAA,QAEEmC,KAAK,CAAE,CACLa,MAAM,CAAE,gBAAgB,CACxBC,YAAY,CAAE,CAAC,CACfb,OAAO,CAAE,EAAE,CACXc,YAAY,CAAE,EAAE,CAChBC,eAAe,CAAE,MAAM,CACvBC,SAAS,CAAE,4BACb,CAAE,CAAAZ,QAAA,eAEF1C,IAAA,OAAA0C,QAAA,CAAKE,CAAC,CAACW,GAAG,CAAK,CAAC,cAChBrD,KAAA,MAAAwC,QAAA,eACE1C,IAAA,WAAA0C,QAAA,CAAQ,gCAAc,CAAQ,CAAC,IAAC,CAACE,CAAC,CAACY,SAAS,EAC3C,CAAC,cACJtD,KAAA,MAAAwC,QAAA,eACE1C,IAAA,WAAA0C,QAAA,CAAQ,6BAAc,CAAQ,CAAC,IAAC,CAACE,CAAC,CAACa,iBAAiB,EAAI,GAAG,EAC1D,CAAC,cACJvD,KAAA,MAAAwC,QAAA,eACE1C,IAAA,WAAA0C,QAAA,CAAQ,gCAAe,CAAQ,CAAC,IAAC,CAACE,CAAC,CAACc,cAAc,EAAI,GAAG,EACxD,CAAC,cACJxD,KAAA,MAAAwC,QAAA,eACE1C,IAAA,WAAA0C,QAAA,CAAQ,wBAAY,CAAQ,CAAC,IAAC,CAACE,CAAC,CAACe,OAAO,CAAC,GAAC,CAACf,CAAC,CAACgB,GAAG,EAC/C,CAAC,CACHhB,CAAC,CAACiB,QAAQ,eACT3D,KAAA,MAAAwC,QAAA,eACE1C,IAAA,WAAA0C,QAAA,CAAQ,6BAAc,CAAQ,CAAC,CAAC,GAAG,CAClC,GAAI,CAAAoB,IAAI,CAAClB,CAAC,CAACiB,QAAQ,CAAC,CAACE,cAAc,CAAC,CAAC,EACrC,CACJ,cAED/D,IAAA,aACEgE,WAAW,CAAC,+BAA+B,CAC3CC,KAAK,CAAEvD,WAAW,CAACkC,CAAC,CAACI,EAAE,CAAC,EAAI,EAAG,CAC/BkB,QAAQ,CAAGC,CAAC,EACVxD,cAAc,CAAEwB,IAAI,EAAAC,aAAA,CAAAA,aAAA,IACfD,IAAI,MACP,CAACS,CAAC,CAACI,EAAE,EAAGmB,CAAC,CAACC,MAAM,CAACH,KAAK,EACtB,CACH,CACD5B,KAAK,CAAE,CACLgC,KAAK,CAAE,MAAM,CACbC,SAAS,CAAE,EAAE,CACbhC,OAAO,CAAE,CAAC,CACVa,YAAY,CAAE,CAAC,CACfD,MAAM,CAAE,gBACV,CAAE,CACH,CAAC,CAEDN,CAAC,CAACf,MAAM,GAAK,KAAK,eACjB3B,KAAA,QAAKmC,KAAK,CAAE,CAAEiC,SAAS,CAAE,EAAG,CAAE,CAAA5B,QAAA,eAC5B1C,IAAA,MAAA0C,QAAA,cACE1C,IAAA,WAAA0C,QAAA,CAAQ,iCAAkB,CAAQ,CAAC,CAClC,CAAC,cACJ1C,IAAA,WACEuE,OAAO,CAAEA,CAAA,GAAMlD,gBAAgB,CAACuB,CAAC,CAACI,EAAE,CAAE,WAAW,CAAE,CACnDX,KAAK,CAAE,CACLmC,WAAW,CAAE,EAAE,CACfnB,eAAe,CAAE,SAAS,CAC1BoB,KAAK,CAAE,MAAM,CACbnC,OAAO,CAAE,UAAU,CACnBY,MAAM,CAAE,MAAM,CACdC,YAAY,CAAE,CAChB,CAAE,CAAAT,QAAA,CACH,kBAED,CAAQ,CAAC,cAET1C,IAAA,WACEuE,OAAO,CAAEA,CAAA,GAAMlD,gBAAgB,CAACuB,CAAC,CAACI,EAAE,CAAE,eAAe,CAAE,CACvDX,KAAK,CAAE,CACLgB,eAAe,CAAE,SAAS,CAC1BoB,KAAK,CAAE,MAAM,CACbnC,OAAO,CAAE,UAAU,CACnBY,MAAM,CAAE,MAAM,CACdC,YAAY,CAAE,CAChB,CAAE,CAAAT,QAAA,CACH,sBAED,CAAQ,CAAC,EACN,CACN,CAEAG,UAAU,CAAC6B,MAAM,CAAG,CAAC,eACpBxE,KAAA,QACEmC,KAAK,CAAE,CACLiC,SAAS,CAAE,EAAE,CACbjB,eAAe,CAAE,SAAS,CAC1Bf,OAAO,CAAE,EAAE,CACXa,YAAY,CAAE,CAChB,CAAE,CAAAT,QAAA,eAEF1C,IAAA,WAAA0C,QAAA,CAAQ,kCAAsB,CAAQ,CAAC,cACvC1C,IAAA,OAAIqC,KAAK,CAAE,CAAEiC,SAAS,CAAE,CAAE,CAAE,CAAA5B,QAAA,CACzBG,UAAU,CAACF,GAAG,CAAEI,CAAC,eAChB7C,KAAA,OAAAwC,QAAA,EACG,GAAI,CAAAoB,IAAI,CAACf,CAAC,CAAC4B,IAAI,CAAC,CAACZ,cAAc,CAAC,CAAC,CAAC,UAAG,CAAChB,CAAC,CAACd,YAAY,CACpDc,CAAC,CAACrC,WAAW,aAAAwB,MAAA,CAAUa,CAAC,CAACrC,WAAW,CAAE,GAFhCqC,CAAC,CAACC,EAGP,CACL,CAAC,CACA,CAAC,EACF,CACN,GArGIJ,CAAC,CAACI,EAsGJ,CAAC,CAEV,CAAC,CAAC,EACC,CAAC,CAEV","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}